<div id="invertTreePreview"></div>

<script>
(function(){
  const container = document.getElementById('invertTreePreview');
  container.innerHTML = `
    <style>
      .controls { display:flex; gap:8px; margin-bottom:12px; }
      .tree { display:flex; justify-content:center; margin-top:20px; flex-direction:column; align-items:center; }
      .node { display:flex; flex-direction:column; align-items:center; margin:5px; transition: transform 0.3s; }
      .value { width:30px; height:30px; border-radius:50%; background:#3b82f6; color:white; display:flex; justify-content:center; align-items:center; font-weight:bold; transition: transform 0.3s; }
      .current { outline:3px solid #f59e0b; transform:scale(1.2); }
      .children { display:flex; gap:40px; margin-top:8px; justify-content:center; }
      pre { background:#fff; padding:10px; border-radius:8px; border:1px solid #e6e6e6; min-height:50px; }
    </style>
    <div class="controls">
      <button id="prevBtn">Prev</button>
      <button id="nextBtn">Next</button>
      <button id="runBtn">Run to End</button>
      <button id="resetBtn">Reset</button>
    </div>
    <pre id="info"></pre>
    <div id="treeContainer" class="tree"></div>
  `;

  const treeExample = { val:4, left:{val:2,left:{val:1},right:{val:3}}, right:{val:7,left:{val:6},right:{val:9}} };
  let steps = [], stepIndex = 0;

  function cloneTree(node){
    if(!node) return null;
    return { val: node.val, left: cloneTree(node.left), right: cloneTree(node.right) };
  }

  function invertTreeSteps(node){
    if(!node) return null;
    steps.push({action:'visit', node});
    const left = invertTreeSteps(node.left);
    const right = invertTreeSteps(node.right);
    node.left = right;
    node.right = left;
    steps.push({action:'swap', node});
    return node;
  }

  const root = cloneTree(treeExample);
  invertTreeSteps(cloneTree(root));

  const treeContainer = container.querySelector('#treeContainer');
  const infoEl = container.querySelector('#info');

  function renderTree(node, highlightNode){
    if(!node) return null;
    const nodeEl = document.createElement('div');
    nodeEl.className = 'node';
    const valEl = document.createElement('div');
    valEl.className = 'value';
    if(node === highlightNode) valEl.classList.add('current');
    valEl.textContent = node.val;
    nodeEl.appendChild(valEl);

    if(node.left || node.right){
      const childrenEl = document.createElement('div');
      childrenEl.className = 'children';
      childrenEl.appendChild(renderTree(node.left, highlightNode) || document.createElement('div'));
      childrenEl.appendChild(renderTree(node.right, highlightNode) || document.createElement('div'));
      nodeEl.appendChild(childrenEl);
    }
    return nodeEl;
  }

  function findNode(node, val){
    if(!node) return null;
    if(node.val === val) return node;
    return findNode(node.left,val) || findNode(node.right,val);
  }

  function render(){
    const treeClone = cloneTree(root);
    for(let i=0;i<=stepIndex;i++){
      const s = steps[i];
      if(s.action==='swap'){
        const n = findNode(treeClone,s.node.val);
        if(n){
          const tmp = n.left; n.left = n.right; n.right = tmp;
        }
      }
    }
    treeContainer.innerHTML = '';
    const highlight = steps[stepIndex] ? steps[stepIndex].node : null;
    treeContainer.appendChild(renderTree(treeClone, highlight));

    const s = steps[stepIndex];
    if(s.action==='visit') infoEl.textContent = `Visiting node ${s.node.val}`;
    else if(s.action==='swap') infoEl.textContent = `Swapped children of node ${s.node.val}`;

    container.querySelector('#prevBtn').disabled = stepIndex===0;
    container.querySelector('#nextBtn').disabled = stepIndex>=steps.length-1;
  }

  function next(){ if(stepIndex<steps.length-1){ stepIndex++; render(); } }
  function prev(){ if(stepIndex>0){ stepIndex--; render(); } }

  container.querySelector('#nextBtn').addEventListener('click', next);
  container.querySelector('#prevBtn').addEventListener('click', prev);
  container.querySelector('#runBtn').addEventListener('click', ()=>{ while(stepIndex<steps.length-1){ stepIndex++; } render(); });
  container.querySelector('#resetBtn').addEventListener('click', ()=>{ stepIndex=0; render(); });

  render();
})();
</script>
